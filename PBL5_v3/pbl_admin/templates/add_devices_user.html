{% extends 'base_with_navbar_admin.html' %}

{% block title %}
    Mua thiết bị
{% endblock title %}

{% block style %}
    <style>
        .bill, .get-cost{
            float: left;
            margin: 10px;
            margin-left: 100px;
        }

        .submit {
            float: right;
            margin: 10px;
            margin-right: 100px;
        }
    </style>
{% endblock style %}

{% block body %}
    <h1> Mua thiết bị </h1>   
    <form method="post">{% csrf_token %}
        <table class="table table-striped table-inverse table-responsive" id="table_devices">
            <thead class="thead-inverse">
                <tr>
                    <th>Tên thiết bị</th>
                    <th>Hình ảnh</th>
                    <th>Đơn giá</th>
                    <th>Số lượng</th>
                    <th>Xác nhận mua</th>
                </tr>
            </thead>
                <tbody>
                    {% for name, image, cost, total in zip_devices_user %}
                        <tr>
                            <td scope="row">{{name}}</td>
                            <td><img src="{{image}}" alt="Hình ảnh sản phẩm" height="70px" width="70px"></td>
                            <td>{{cost}}</td>
                            <td>
                                <input type="number" name="count[]" min="1" max="{{total}}" style="width: 2cm;">
                            </td>
                            <td><input type="checkbox" name="confirm[]" id="confirm" value="{{name}}" onclick="getConfirm()"></td>
                        </tr>
                    {% endfor %}
                </tbody>
        </table>
        <div>
            <div class="bill">
                <input type="button" value="Tổng tiền" onclick="getBill()" class="btn btn-primary">
            </div>
            <div class="get-cost">
                <input type="text" id="sum" readonly placeholder="Tổng tiền" class="form-control" style="width: 10cm;">
            </div>
            <div class="submit">
                <input type="submit" value="Thanh toán" class="btn btn-primary">
            </div>
        </div>
        
    </form>

    <script>
        var arrChecked = document.getElementsByName('confirm[]');
        var tableDevices = document.getElementById('table_devices');
        var countDevices = document.getElementsByName('count[]'); 
        
        for(var i = 0; i < arrChecked.length; i++) {
                countDevices[i].disabled = true;
        }
        
        function getConfirm() {
            for(var i = 0; i < arrChecked.length; i++) {
                countDevices[i].disabled = true;
                if(arrChecked[i].checked) {
                    countDevices[i].disabled = false;
                }
            }
        }

        function getBill() {
            var sum = 0;
            for(var i = 0; i < arrChecked.length; i++) {
                if(arrChecked[i].checked) {
                    cost = Number(tableDevices.rows[i+1].cells[2].innerHTML);
                    count = Number(countDevices[i].value);
                    sum += cost*count;
                }
            }

            if(sum > 0) {
                document.getElementById('sum').value = sum;
            } else {
                document.getElementById('sum').value = 'Số lượng mua không hợp lệ';
            }

            
        }
    </script>
{% endblock body %}